#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/rules/utils.mk
include /usr/share/cdbs/1/class/gnome.mk
include /usr/share/gnome-pkg-tools/1/rules/uploaders.mk
include /usr/share/gnome-pkg-tools/1/rules/gnome-version.mk
include /usr/share/gnome-pkg-tools/1/rules/clean-la.mk
-include /usr/share/gnome-pkg-tools/1/rules/gnome-get-source.mk

GNOME_MODULE := gnome-control-center

LDFLAGS += -Wl,-z,defs -Wl,-O1 -Wl,--as-needed

DEB_CONFIGURE_EXTRA_FLAGS += --disable-mime-cache \
                             --disable-scrollkeeper \
                             --enable-aboutme \
                             --enable-gstreamer=0.10 \
                             --disable-update-mimedb \
                             --disable-hal

DEB_INSTALL_MANPAGES_gnome-control-center += debian/gnome-control-center.1

DEB_DH_MAKESHLIBS_ARGS_gnome-control-center = --no-act
DEB_DH_MAKESHLIBS_ARGS_libgnome-window-settings1 = -V "libgnome-window-settings1 (>= 1:2.17.5)"

build/gnome-control-center:: $(DEB_INSTALL_MANPAGES_gnome-control-center)

%.1: %.sgml
	/usr/bin/docbook-to-man $< >$@

pre-build::
	find . -type f -exec touch '{}' \;
	find . -type d -exec touch '{}' \;

clean::
	rm -f $(DEB_INSTALL_MANPAGES_gnome-control-center)

install/capplets-data::
	cp debian/visual-effects_custom.svg debian/tmp/usr/share/gnome-control-center/pixmaps
	cp debian/visual-effects_extra.svg debian/tmp/usr/share/gnome-control-center/pixmaps
	cp debian/visual-effects_none.svg debian/tmp/usr/share/gnome-control-center/pixmaps
	cp debian/visual-effects_normal.svg debian/tmp/usr/share/gnome-control-center/pixmaps

binary-post-install/capplets-data::
	rm -rf debian/capplets-data/usr/share/applications/mimeinfo.cache
	rm -rf debian/capplets-data/usr/share/pkgconfig
	dh_installmime -p$(cdbs_curpkg)
