Description: Use pre-installed Ubuntu Desktop Guide instead of GNOME help when
 running Unity
Forwarded: not-needed
Author: Jeremy Bicha <jbicha@ubuntu.com>
--- a/panels/bluetooth/cc-bluetooth-panel.c
+++ b/panels/bluetooth/cc-bluetooth-panel.c
@@ -73,7 +73,10 @@
 static const char *
 cc_bluetooth_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/bluetooth";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/bluetooth";
+  else
+    return "help:gnome-help/bluetooth";
 }
 
 static void
--- a/panels/color/cc-color-panel.c
+++ b/panels/color/cc-color-panel.c
@@ -2285,7 +2285,10 @@
 static const char *
 cc_color_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/color";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/color";
+  else
+    return "help:gnome-help/color";
 }
 
 static void
@@ -2567,6 +2570,12 @@
   g_signal_connect (widget, "realize",
                     G_CALLBACK (gcm_prefs_window_realize_cb),
                     prefs);
+
+  widget = WID (priv->builder, "linkbutton_help");
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    g_object_set (G_OBJECT (widget),
+              "uri", "help:ubuntu-help/color-whyimportant",
+              NULL);
 }
 
 void
--- a/panels/datetime/cc-datetime-panel.c
+++ b/panels/datetime/cc-datetime-panel.c
@@ -178,7 +178,10 @@
 static const char *
 cc_date_time_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/clock";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/clock";
+  else
+    return "help:gnome-help/clock";
 }
 
 static void
--- a/panels/display/cc-display-panel.c
+++ b/panels/display/cc-display-panel.c
@@ -205,7 +205,10 @@
 static const char *
 cc_display_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/prefs-display";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/prefs-display";
+  else
+    return "help:gnome-help/prefs-display";
 }
 
 static void
--- a/panels/mouse/cc-mouse-panel.c
+++ b/panels/mouse/cc-mouse-panel.c
@@ -107,7 +107,10 @@
 static const char *
 cc_mouse_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/mouse";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/mouse";
+  else
+    return "help:gnome-help/mouse";
 }
 
 static void
--- a/panels/network/cc-network-panel.c
+++ b/panels/network/cc-network-panel.c
@@ -242,7 +242,10 @@
 static const char *
 cc_network_panel_get_help_uri (CcPanel *panel)
 {
-	return "help:gnome-help/net";
+        if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+            return "help:ubuntu-help/net";
+        else
+            return "help:gnome-help/net";
 }
 
 static void
--- a/panels/online-accounts/cc-online-accounts-panel.c
+++ b/panels/online-accounts/cc-online-accounts-panel.c
@@ -256,7 +256,10 @@
 static const char *
 goa_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/accounts";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/accounts";
+  else
+    return "help:gnome-help/accounts";
 }
 
 static void
--- a/panels/power/cc-power-panel.c
+++ b/panels/power/cc-power-panel.c
@@ -124,7 +124,10 @@
 static const char *
 cc_power_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/power";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/power";
+  else
+    return "help:gnome-help/power";
 }
 
 static void
--- a/panels/printers/cc-printers-panel.c
+++ b/panels/printers/cc-printers-panel.c
@@ -251,7 +251,10 @@
 static const char *
 cc_printers_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/printing";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/printing";
+  else
+    return "help:gnome-help/printing";
 }
 
 static void
--- a/panels/screen/cc-screen-panel.c
+++ b/panels/screen/cc-screen-panel.c
@@ -146,7 +146,10 @@
 static const char *
 cc_screen_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/prefs-display";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/prefs-display";
+  else
+    return "help:gnome-help/prefs-display";
 }
 
 static void
--- a/panels/sound/cc-sound-panel.c
+++ b/panels/sound/cc-sound-panel.c
@@ -70,7 +70,10 @@
 static const char *
 cc_sound_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/media#sound";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/media#sound";
+  else
+    return "help:gnome-help/media#sound";
 }
 
 static void
--- a/panels/universal-access/cc-ua-panel.c
+++ b/panels/universal-access/cc-ua-panel.c
@@ -159,7 +159,10 @@
 static const char *
 cc_ua_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/a11y";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/a11y";
+  else
+    return "help:gnome-help/a11y";
 }
 
 static void
--- a/panels/user-accounts/um-password-dialog.c
+++ b/panels/user-accounts/um-password-dialog.c
@@ -523,9 +523,14 @@
 
         widget = (GtkWidget *) gtk_builder_get_object (builder, "password-normal-strength-hints-label");
         old_label = gtk_label_get_label (GTK_LABEL (widget));
-        label = g_strdup_printf ("<a href=\"%s\">%s</a>",
-                                 "help:gnome-help/user-goodpassword",
-                                 old_label);
+        if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+            label = g_strdup_printf ("<a href=\"%s\">%s</a>",
+                                 "help:ubuntu-help/user-goodpassword",
+                                  old_label);
+        else
+            label = g_strdup_printf ("<a href=\"%s\">%s</a>",
+                                  "help:gnome-help/user-goodpassword",
+                                  old_label);
         gtk_label_set_markup (GTK_LABEL (widget), label);
         g_free (label);
 
--- a/panels/user-accounts/um-user-panel.c
+++ b/panels/user-accounts/um-user-panel.c
@@ -1372,7 +1372,10 @@
 static const char *
 um_user_panel_get_help_uri (CcPanel *panel)
 {
-	return "help:gnome-help/user-accounts";
+ if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+   return "help:ubuntu-help/user-accounts";
+ else
+ return "help:gnome-help/user-accounts";
 }
 
 static void
--- a/panels/wacom/cc-wacom-panel.c
+++ b/panels/wacom/cc-wacom-panel.c
@@ -123,7 +123,10 @@
 static const char *
 cc_wacom_panel_get_help_uri (CcPanel *panel)
 {
-  return "help:gnome-help/wacom";
+  if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+    return "help:ubuntu-help/wacom";
+  else
+    return "help:gnome-help/wacom";
 }
 
 static void
--- a/shell/control-center.c
+++ b/shell/control-center.c
@@ -175,8 +175,12 @@
 
   if (panel)
     uri = cc_panel_get_help_uri (panel);
-
-  gtk_show_uri (gtk_widget_get_screen (window),
+    if (!g_strcmp0(g_getenv("XDG_CURRENT_DESKTOP"), "Unity"))
+      gtk_show_uri (gtk_widget_get_screen (window),
+                uri ? uri : "help:ubuntu-help/prefs",
+                GDK_CURRENT_TIME, NULL);
+    else
+      gtk_show_uri (gtk_widget_get_screen (window),
                 uri ? uri : "help:gnome-help/prefs",
                 GDK_CURRENT_TIME, NULL);
 }
