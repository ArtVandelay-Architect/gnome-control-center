From c384570bace7055e5fb6b7e9208086e749fd325d Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Fri, 09 Nov 2012 13:30:39 +0000
Subject: universal-access: Always show the zoom options

Now that the fallback mode is gone. #fallback

https://bugzilla.gnome.org/show_bug.cgi?id=682862
---
Index: gnome-control-center-3.8.3/panels/universal-access/cc-ua-panel.c
===================================================================
--- gnome-control-center-3.8.3.orig/panels/universal-access/cc-ua-panel.c	2013-06-11 20:04:34.087380775 -0400
+++ gnome-control-center-3.8.3/panels/universal-access/cc-ua-panel.c	2013-06-11 20:04:34.083380775 -0400
@@ -60,6 +60,7 @@
   GSettings *mediakeys_settings;
 
   ZoomOptions *zoom_options;
+  guint shell_watch_id;
 };
 
 
@@ -94,6 +95,12 @@
 {
   CcUaPanelPrivate *priv = CC_UA_PANEL (object)->priv;
 
+  if (priv->shell_watch_id)
+    {
+      g_bus_unwatch_name (priv->shell_watch_id);
+      priv->shell_watch_id = 0;
+    }
+
   if (priv->builder)
     {
       g_object_unref (priv->builder);
@@ -300,6 +307,29 @@
 	g_free (text);
 }
 
+static void
+shell_vanished_cb (GDBusConnection *connection,
+		   const gchar *name,
+		   CcUaPanel   *self)
+{
+  CcUaPanelPrivate *priv = self->priv;
+
+  gtk_widget_hide (WID (priv->builder, "zoom_label_box"));
+  gtk_widget_hide (WID (priv->builder, "zoom_value_box"));
+}
+
+static void
+shell_appeared_cb (GDBusConnection *connection,
+		   const gchar *name,
+		   const gchar *name_owner,
+		   CcUaPanel   *self)
+{
+  CcUaPanelPrivate *priv = self->priv;
+
+  gtk_widget_show (WID (priv->builder, "zoom_label_box"));
+  gtk_widget_show (WID (priv->builder, "zoom_value_box"));
+}
+
 static gboolean
 get_large_text_mapping (GValue   *value,
                         GVariant *variant,
@@ -401,6 +431,13 @@
                    WID (priv->builder, "seeing_toggle_keys_switch"), "active",
                    G_SETTINGS_BIND_DEFAULT);
 
+  priv->shell_watch_id = g_bus_watch_name (G_BUS_TYPE_SESSION,
+					   "org.gnome.Shell",
+					   G_BUS_NAME_WATCHER_FLAGS_NONE,
+					   (GBusNameAppearedCallback) shell_appeared_cb,
+					   (GBusNameVanishedCallback) shell_vanished_cb,
+					   self,
+					   NULL);
   g_signal_connect (WID (priv->builder, "seeing_zoom_preferences_button"),
                     "clicked",
                     G_CALLBACK (zoom_options_launch_cb), self);
