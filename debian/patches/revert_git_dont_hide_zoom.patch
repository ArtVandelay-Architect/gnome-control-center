From c384570bace7055e5fb6b7e9208086e749fd325d Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Fri, 09 Nov 2012 13:30:39 +0000
Subject: universal-access: Always show the zoom options

Now that the fallback mode is gone. #fallback

https://bugzilla.gnome.org/show_bug.cgi?id=682862
---
--- a/panels/universal-access/cc-ua-panel.c
+++ b/panels/universal-access/cc-ua-panel.c
@@ -102,6 +102,7 @@
   GSettings *application_settings;
 
   ZoomOptions *zoom_options;
+  guint shell_watch_id;
 
   GtkAdjustment *focus_adjustment;
 
@@ -116,6 +117,12 @@
 {
   CcUaPanelPrivate *priv = CC_UA_PANEL (object)->priv;
 
+  if (priv->shell_watch_id)
+    {
+      g_bus_unwatch_name (priv->shell_watch_id);
+      priv->shell_watch_id = 0;
+    }
+
   g_clear_object (&priv->builder);
   g_slist_free_full (priv->toplevels, (GDestroyNotify)gtk_widget_destroy);
   priv->toplevels = NULL;
@@ -177,6 +184,29 @@
   return (factor > DPI_FACTOR_NORMAL);
 }
 
+static void
+shell_vanished_cb (GDBusConnection *connection,
+		   const gchar *name,
+		   CcUaPanel   *self)
+{
+  CcUaPanelPrivate *priv = self->priv;
+
+  gtk_widget_hide (WID ("zoom_label_box"));
+  gtk_widget_hide (WID ("zoom_value_box"));
+}
+
+static void
+shell_appeared_cb (GDBusConnection *connection,
+		   const gchar *name,
+		   const gchar *name_owner,
+		   CcUaPanel   *self)
+{
+  CcUaPanelPrivate *priv = self->priv;
+
+  gtk_widget_show (WID ("zoom_label_box"));
+  gtk_widget_show (WID ("zoom_value_box"));
+}
+
 static gboolean
 get_large_text_mapping (GValue   *value,
                         GVariant *variant,
@@ -445,6 +475,13 @@
                                 NULL);
 
   /* zoom */
+  priv->shell_watch_id = g_bus_watch_name (G_BUS_TYPE_SESSION,
+					   "org.gnome.Shell",
+					   G_BUS_NAME_WATCHER_FLAGS_NONE,
+					   (GBusNameAppearedCallback) shell_appeared_cb,
+					   (GBusNameVanishedCallback) shell_vanished_cb,
+					   self,
+					   NULL);
 
   g_settings_bind_with_mapping (priv->application_settings, "screen-magnifier-enabled",
                                 WID ("value_zoom"),
