From 6f07b9014326e3234af305743c94018117a6001b Mon Sep 17 00:00:00 2001
From: Tim Lunn <tim@feathertop.org>
Date: Wed, 1 Oct 2014 08:04:06 +1000
Subject: [PATCH] Revert "datetime: Show the automatic timezone switch"

This reverts commit c68f9eca501b662fd819bab1ae021098a7cdaf9b.
---
 panels/datetime/cc-datetime-panel.c | 25 ++-----------------------
 panels/datetime/datetime.ui         |  1 -
 2 files changed, 2 insertions(+), 24 deletions(-)

diff --git a/panels/datetime/cc-datetime-panel.c b/panels/datetime/cc-datetime-panel.c
index ec76d22..ec3cf0c 100644
--- a/panels/datetime/cc-datetime-panel.c
+++ b/panels/datetime/cc-datetime-panel.c
@@ -64,9 +64,6 @@ enum {
 
 #define FILECHOOSER_SCHEMA "org.gtk.Settings.FileChooser"
 
-#define DATETIME_SCHEMA "org.gnome.desktop.datetime"
-#define AUTO_TIMEZONE_KEY "automatic-timezone"
-
 struct _CcDateTimePanelPrivate
 {
   GtkBuilder *builder;
@@ -83,7 +80,6 @@ struct _CcDateTimePanelPrivate
   GDateTime *date;
 
   GSettings *clock_settings;
-  GSettings *datetime_settings;
   GSettings *filechooser_settings;
   GDesktopClockFormat clock_format;
   gboolean ampm_available;
@@ -133,7 +129,6 @@ cc_date_time_panel_dispose (GObject *object)
   g_clear_object (&priv->dtm);
   g_clear_object (&priv->permission);
   g_clear_object (&priv->clock_settings);
-  g_clear_object (&priv->datetime_settings);
   g_clear_object (&priv->filechooser_settings);
 
   g_clear_pointer (&priv->date, g_date_time_unref);
@@ -752,17 +747,15 @@ on_permission_changed (GPermission *permission,
                        gpointer     data)
 {
   CcDateTimePanelPrivate *priv = CC_DATE_TIME_PANEL (data)->priv;
-  gboolean allowed, auto_timezone, using_ntp;
+  gboolean allowed, using_ntp;
 
   allowed = (priv->permission == NULL || g_permission_get_allowed (priv->permission));
   using_ntp = gtk_switch_get_active (GTK_SWITCH (W("network_time_switch")));
-  auto_timezone = gtk_switch_get_active (GTK_SWITCH (W("auto_timezone_switch")));
 
   /* All the widgets but the lock button and the 24h setting */
   gtk_widget_set_sensitive (W("auto-datetime-row"), allowed);
-  gtk_widget_set_sensitive (W("auto-timezone-row"), allowed);
   gtk_widget_set_sensitive (W("datetime-button"), allowed && !using_ntp);
-  gtk_widget_set_sensitive (W("timezone-button"), allowed && !auto_timezone);
+  gtk_widget_set_sensitive (W("timezone-button"), allowed);
 
   /* Hide the subdialogs if we no longer have permissions */
   if (!allowed)
@@ -953,10 +946,6 @@ list_box_row_activated (GtkListBox      *listbox,
     {
       toggle_switch (W ("network_time_switch"));
     }
-  else if (!g_strcmp0 (widget_name, "auto-timezone-row"))
-    {
-      toggle_switch (W ("auto_timezone_switch"));
-    }
   else if ((found = g_strrstr (widget_name, "button")))
     {
       /* replace "button" with "dialog" */
@@ -1292,16 +1281,6 @@ cc_date_time_panel_init (CcDateTimePanel *self)
   g_signal_connect (W("network_time_switch"), "notify::active",
                     G_CALLBACK (change_ntp), self);
 
-  /* Timezone settings */
-  bind_switch_to_row (self,
-                      W ("auto_timezone_switch"),
-                      W ("timezone-button"));
-
-  priv->datetime_settings = g_settings_new (DATETIME_SCHEMA);
-  g_settings_bind (priv->datetime_settings, AUTO_TIMEZONE_KEY,
-                   W ("auto_timezone_switch"), "active",
-                   G_SETTINGS_BIND_DEFAULT);
-
   /* Clock settings */
   priv->clock_settings = g_settings_new (CLOCK_SCHEMA);
 
diff --git a/panels/datetime/datetime.ui b/panels/datetime/datetime.ui
index c7cdcf2..0c01db6 100644
--- a/panels/datetime/datetime.ui
+++ b/panels/datetime/datetime.ui
@@ -548,7 +548,6 @@
                 <property name="can_focus">True</property>
                 <child>
                   <object class="GtkBox" id="box3">
-                    <property name="visible">True</property>
                     <property name="can_focus">False</property>
                     <property name="spacing">50</property>
                     <child>
-- 
2.1.0


