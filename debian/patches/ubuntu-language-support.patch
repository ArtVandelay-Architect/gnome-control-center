From: Jeremy Bicha <jbicha@ubuntu.com>
Date: Thu, 14 Sep 2017 09:23:42 -0400
Subject: [PATCH] region: Add Language Selector button

Workaround for https://launchpad.net/bugs/1631750
---
 panels/region/cc-region-panel.c | 30 ++++++++++++++++++++++++++++++
 panels/region/region.ui         | 26 ++++++++++++++++++++++++++
 2 files changed, 56 insertions(+)

diff --git a/panels/region/cc-region-panel.c b/panels/region/cc-region-panel.c
index 1e4ffdc..3084f35 100644
--- a/panels/region/cc-region-panel.c
+++ b/panels/region/cc-region-panel.c
@@ -108,6 +108,7 @@ struct _CcRegionPanel {
         GtkWidget *show_layout;
         GtkWidget *restart_button;
         GtkWidget *language_list;
+        GtkWidget *language_support_button;
 
         GSettings *input_settings;
         GnomeXkbInfo *xkb_info;
@@ -1284,6 +1285,33 @@ show_selected_settings (CcRegionPanel *self)
                 g_warning ("Failed to launch input source setup: %s", error->message);
 }
 
+
+static void
+show_language_support (CcRegionPanel *self)
+{
+        GAppInfo *app_info;
+        GdkAppLaunchContext *ctx;
+        GError *error = NULL;
+
+        app_info = G_APP_INFO (g_desktop_app_info_new ("gnome-language-selector.desktop"));
+
+        if (app_info) {
+                ctx = gdk_display_get_app_launch_context (gdk_display_get_default ());
+                g_app_info_launch (app_info, NULL, G_APP_LAUNCH_CONTEXT (ctx), &error);
+        } else {
+                g_warning ("Failed to launch language-selector: couldn't create GDesktopAppInfo");
+                return;
+        }
+
+        if (error) {
+                g_warning ("Failed to launch language-selector: %s", error->message);
+                g_error_free (error);
+        }
+
+       g_object_unref (app_info);
+       g_object_unref (ctx);
+}
+
 static void
 show_selected_layout (CcRegionPanel *self)
 {
@@ -1747,6 +1775,7 @@ cc_region_panel_class_init (CcRegionPanelClass * klass)
         gtk_widget_class_bind_template_child (widget_class, CcRegionPanel, restart_button);
         gtk_widget_class_bind_template_child (widget_class, CcRegionPanel, login_label);
         gtk_widget_class_bind_template_child (widget_class, CcRegionPanel, language_list);
+        gtk_widget_class_bind_template_child (widget_class, CcRegionPanel, language_support_button);
 
         gtk_widget_class_bind_template_callback (widget_class, restart_now);
         gtk_widget_class_bind_template_callback (widget_class, show_input_options);
@@ -1756,6 +1785,7 @@ cc_region_panel_class_init (CcRegionPanelClass * klass)
         gtk_widget_class_bind_template_callback (widget_class, move_selected_input_down);
         gtk_widget_class_bind_template_callback (widget_class, show_selected_settings);
         gtk_widget_class_bind_template_callback (widget_class, show_selected_layout);
+        gtk_widget_class_bind_template_callback (widget_class, show_language_support);
 }
 
 static void
diff --git a/panels/region/region.ui b/panels/region/region.ui
index 53ebb48..46e3862 100644
--- a/panels/region/region.ui
+++ b/panels/region/region.ui
@@ -544,6 +544,32 @@
                </style>
               </object>
             </child>
+            <child>
+              <object class="GtkBox">
+                <property name="visible">True</property>
+                <property name="can_focus">False</property>
+                <property name="orientation">vertical</property>
+                <child>
+                  <object class="GtkButton" id="language_support_button">
+                    <property name="label" translatable="yes">Manage Installed Languages</property>
+                    <property name="visible">True</property>
+                    <property name="can_focus">True</property>
+                    <property name="receives_default">True</property>
+                    <signal name="clicked" handler="show_language_support" object="CcRegionPanel" swapped="yes"/>
+                  </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">True</property>
+                    <property name="pack_type">end</property>
+                  </packing>
+                </child>
+              </object>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">True</property>
+                <property name="position">3</property>
+              </packing>
+            </child>
           </object>
         </child>
       </object>
