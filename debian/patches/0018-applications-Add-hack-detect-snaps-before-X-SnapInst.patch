From c78de230d7efc2f88aa1340e862d5fae92ac4b12 Mon Sep 17 00:00:00 2001
From: Robert Ancell <robert.ancell@canonical.com>
Date: Tue, 12 Mar 2019 15:31:38 +1300
Subject: [PATCH 18/20] applications: Add hack detect snaps before
 X-SnapInstanceName works

---
 panels/applications/cc-applications-panel.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/panels/applications/cc-applications-panel.c b/panels/applications/cc-applications-panel.c
index f4d0605ad..f0ab8cf21 100644
--- a/panels/applications/cc-applications-panel.c
+++ b/panels/applications/cc-applications-panel.c
@@ -237,6 +237,16 @@ get_portal_app_id (GAppInfo *info)
       snap_name = g_desktop_app_info_get_string (G_DESKTOP_APP_INFO (info), "X-SnapInstanceName");
       if (snap_name != NULL)
         return g_strdup_printf ("%s%s", PORTAL_SNAP_PREFIX, snap_name);
+
+      // FIXME: Hack until X-SnapInstanceName is ready
+      // https://github.com/snapcore/snapd/pull/6520
+      executable = g_desktop_app_info_get_string (G_DESKTOP_APP_INFO (info), "Exec");
+      if (executable != NULL && strstr (executable, "/snap/") != NULL)
+        {
+          const gchar *id = g_app_info_get_id (info);
+          g_auto(GStrv) tokens = g_strsplit (id, "_", 2);
+          return g_strdup_printf ("%s%s", PORTAL_SNAP_PREFIX, tokens[0]);
+        }
     }
 
   return NULL;
-- 
2.24.0

